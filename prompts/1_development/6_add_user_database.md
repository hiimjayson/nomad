@backend

/src/providers 경로에 supabase.ts로 supabase client 만들어줘. 다른 파일들을 참고해서 작성해

---

@backend

zod를 이용해 User 정보 schema 만들어줘
/schemas 경로에 user.ts 파일명으로 생성해
포함 필드는 다음과 같아

uid: string - primary key, uuid, autogenerated
id: string;
nickname: string;
phoneNumber: string;
isTester: boolean;
createdAt: Date;
updatedAt: Date;

---

auth route를 features/auth 경로로 옮기고, 이름은 auth.route.ts로 지정해
auth schema도 같은 경로로 옮기고 auth.schema.ts로 변경해

---

zod parse가 실패하면 400 error 발생하도록 수정해줘
재사용성과 AOP를 고려해서 단계적으로 설계한뒤 코드로 작성해줘

---

validate라는 이름이 너무 범용적인 것 같아. validateBody로 바꾸자

---

pipe가 보통 무슨 역할이지? 이 모듈의 이름을 validateZodPipe로 바꾸면 어떨까?

---

user schema를 내가 지워버렸네.
/features/user 경로에 user.schema.ts 파일명으로 생성해
포함 필드도 다시 알려줄게

uid: string - primary key, uuid, autogenerated
id: string;
nickname: string;
phoneNumber: string;
isTester: boolean;
createdAt: Date;
updatedAt: Date;

---

휴대폰번호를 입력받아 가입여부 체크하는 api 추가해줘.
경로는 /auth/check로 GET으로 구현하자

---

auth schema들이 user schema를 적절히 pick한 후 extend하도록 수정해줘

---

verify code API에서 인증이 성공한 후 다음과 같이 작동하도록 수정해줘

1. 이미 가입된 번호인 경우, JWT를 발급 후 반환한다.
2. 가입되지 않은번호인 경우, 유저 데이터베이스를 생성하고 JWT를 발급 후 반환한다.

응답필드는 다음과 같아.
isNew: boolean:
user: {
uid: string;
}
tokens: {
accessToken: string;
refreshToken: string;
}

---

사용자 관련 로직은 features/user/user.service.ts로 분리해. 그리고 jwt 관련 로직은 providers/jwt.ts로 분리해

---

/auth/refresh api 추가해줘.
Bearer 헤더로 refresh token을 전달받아 유효한 경우 신규 토큰 생성해서 반환하면돼.
응답 필드는

- accessToken: string;
- refreshToken: string;
  이야.
  AOP를 고려해서 설계하고 이를 설명한 뒤 구현해줘

---

@backend

아래 에러가 발생해 수정해줘

src/features/auth/auth.route.ts:74:48 - error TS2339: Property 'token' does not exist on type 'Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>'.

74 const payload = jwt.verifyRefreshToken(req.token!);
